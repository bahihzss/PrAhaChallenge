# 課題１
* PostgreSQL を使えるのであれば、 RLS　でコネクションに対してテナントの絞り込みを有効にする設計にする
* コードレビューは余裕があるからやるものじゃないので、大忙しでもコードレビューはやる （みなさんの職場でレビューってどんな感じでやってるのか気になる）
* ORM やフレームワークがマルチテナントに対応しているのであれば、その機能を使う
  * 直接 SQL を書かなければいけない場合では有効ではないけど、レビューで見逃すリスクは下げられると思う
* テスト、 CI/CD をちゃんとやる

# 課題2-1
https://atmarkit.itmedia.co.jp/fdotnet/bookpreview/azureoverview_0301/azureoverview_0301_01.html

## テナント毎にデータベースを分割する
### メリット
* １テナントごとのスケールはしやすい
* アプリケーションのリリースをテナントごとに行える
* 特定のテナントの障害が他のテナントに影響しにくい

### デメリット
* コストが高い
* テナントごとにデプロイが必要

## テナント毎にスキーマを分割する
スキーマ＝論理データベース？
### メリット
* DBサーバーの管理を全テナント共通で行える

### デメリット
* マイグレーションは各テナントごとに行う必要がある

## すべてのテナントで同じスキーマを使う
### メリット
* リソースが共通化されているので、セットアップコスト、カスタマイズコスト、メンテナンスコストを安く抑えることができる
* インフラのコストも安くなる

### デメリット
* アプリケーションが複雑になる
* 障害が全テナントに影響する
* 課題１のようなセキュリティのリスクがある

# 課題2-2
https://buildersbox.corp-sansan.com/entry/2021/05/10/110000
## テーブル定義時
* テーブルに tenant_id カラムを作る（Bill Oneでは先頭に作るというルールにしました）
* 作成したテーブルに対して、 ENABLE ROW LEVEL SECURITY を適用する
* 作成したテーブルに対して、 CREATE POLICY する
## コネクション取得時
* tenant_id をセットする
## インサート時
テーブルには tenant_id カラムが含まれているので、INSERT文では tenant_id を意識する必要がある。
## それ以外の操作
WHERE句に tenant_id = current_setting('app.tenant_id') が暗黙的に挿入されるので、明示的に書く必要はありません。ただし、DELETE文でWHEREが何もないとさすがに気になるなどの理由で、明示的に書いても良い。

他のテナントの情報を書き込んでしまうリスクは避けられない？？

